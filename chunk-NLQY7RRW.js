import{a as pt,b as B}from"./chunk-LAOFJ4N6.js";import{b as tt,c as et,d as it}from"./chunk-WVPN4BPJ.js";import{a as at}from"./chunk-ML2VBJXM.js";import{a as _t}from"./chunk-MAAQSTPP.js";import{d as st}from"./chunk-H2OXN2IE.js";import{a as rt,d as L}from"./chunk-Q2HNSVUD.js";import{a as ot}from"./chunk-FSBB3O7B.js";import{b as O}from"./chunk-W6ZXQTIG.js";import{a as y}from"./chunk-XSXLIR7R.js";import{$a as W,Da as w,F as u,Fa as l,G as C,Ga as f,Ha as b,Ia as U,O as s,Pa as Z,Ra as Q,T as h,Ta as Y,Ua as q,V as g,Va as J,Xa as K,aa as T,ba as M,ca as P,cb as E,da as I,ea as o,eb as X,fa as r,fb as nt,ga as m,ha as k,ka as _,ma as N,pa as G,q as j,qa as H,r as A,ra as z,sa as F,t as d,ta as p,ua as c,v as S,va as x,w as $}from"./chunk-JKYKRWW6.js";import{f as ut}from"./chunk-DM275RSA.js";var lt=ut(_t());var ct=(()=>{let e=class e{constructor(){this.resourceUrl=nt("stats"),this.http=d(K)}main(n){return this.http.get(`${this.resourceUrl}/botStats`,{params:this.convert(n)})}tariff(n,i){return this.http.get(`${this.resourceUrl}/tariffStats/${n}`,{params:this.convert(i)})}loadTariffStatistic(n,i){return this.http.get(`${this.resourceUrl}/tariffStats/${n}/subscriptionStats`,{params:this.convert(i)})}loadStatistic(n){return this.http.get(`${this.resourceUrl}/botStats/subscriptionStats`,{params:this.convert(n)})}convert(n){return Object.keys(n).forEach(i=>{n[i]||delete n[i]}),n}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=j({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var xt=["price"],mt=t=>({currency:t});function vt(t,e){if(t&1&&(p(0),l(1,"dateRus")),t&2){let a=_(2);x(" ",b(1,1,a.firstDate,a.lastDate)," - ")}}function St(t,e){if(t&1&&(o(0,"div",8)(1,"div",9),u(),o(2,"svg",10),m(3,"path",11),r()(),C(),o(4,"span",12),p(5),r(),o(6,"p",13),p(7),l(8,"translatePaid"),r()()),t&2){let a=_(2);s(5),c(a.stats.users_count),s(2),c(f(8,2,"stats_page__metric_users_count"))}}function bt(t,e){if(t&1&&(o(0,"div",8)(1,"div",9),u(),o(2,"svg",10),m(3,"path",11),r()(),C(),o(4,"span",12),p(5),r(),o(6,"p",13),p(7),l(8,"translatePaid"),r()()),t&2){let a=_(2);s(5),c(a.stats.inactive_users),s(2),c(f(8,2,"stats_page__metric_inactive_users"))}}function yt(t,e){t&1&&k(0)}function Tt(t,e){if(t&1&&(o(0,"p"),p(1),h(2,yt,1,0,"ng-container",20),r()),t&2){let a=e.$implicit;_(2);let n=F(2);s(),x("",a.amount," "),s(),g("ngTemplateOutlet",n)("ngTemplateOutletContext",w(3,mt,a.currency))}}function Mt(t,e){t&1&&k(0)}function Pt(t,e){if(t&1&&(o(0,"p"),p(1),h(2,Mt,1,0,"ng-container",20),r()),t&2){let a=e.$implicit;_(2);let n=F(2);s(),x("",a.amount," "),s(),g("ngTemplateOutlet",n)("ngTemplateOutletContext",w(3,mt,a.currency))}}function It(t,e){t&1&&(o(0,"div",21)(1,"p"),p(2),l(3,"translatePaid"),r(),o(4,"span",22),u(),o(5,"svg",23),m(6,"path",24),r()()()),t&2&&(s(2),c(f(3,1,"stats_page__subs_stats__tariff_stats")))}function wt(t,e){if(t&1&&(o(0,"div",3)(1,"div",4)(2,"p"),p(3),l(4,"translatePaid"),o(5,"a",5),h(6,vt,2,4),p(7),l(8,"dateRus"),r()()(),o(9,"div",6),h(10,St,9,4,"div",7)(11,bt,9,4,"div",7),o(12,"div",8)(13,"div",9),u(),o(14,"svg",10),m(15,"path",11),r()(),C(),o(16,"span",12),p(17),r(),o(18,"p",13),p(19,"\u041A\u0443\u043F\u0438\u0432\u0448\u0438\u0445 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443"),r()(),o(20,"div",8)(21,"div",9),u(),o(22,"svg",10),m(23,"path",11),r()(),C(),o(24,"span",12),p(25),l(26,"mask"),r(),o(27,"p",13),p(28),l(29,"translatePaid"),r()(),o(30,"div",8)(31,"div",9),u(),o(32,"svg",10),m(33,"path",11),r()(),C(),o(34,"span",12),p(35),r(),o(36,"p",13),p(37),l(38,"translatePaid"),r()(),o(39,"div",8)(40,"div",9),u(),o(41,"svg",10),m(42,"path",11),r()(),C(),o(43,"div",14),P(44,Tt,3,5,"p",null,M),r(),o(46,"p",13),p(47,"\u0414\u043E\u0445\u043E\u0434 \u043F\u0440\u043E\u0435\u043A\u0442\u0430"),r()()(),o(48,"div",15)(49,"div",9),u(),o(50,"svg",10),m(51,"path",11),r()(),C(),o(52,"div",14),P(53,Pt,3,5,"p",null,M),r(),o(55,"p",13),p(56),l(57,"translatePaid"),r()(),o(58,"div",4)(59,"p"),p(60),l(61,"translatePaid"),r()(),o(62,"div",16)(63,"span",17),p(64),r(),m(65,"canvas",18,1),r(),h(67,It,7,3,"div",19),r()),t&2){let a=_();s(3),x(" ",f(4,14,"stats_page__period")," "),s(3),T(6,a.firstDate?6:-1),s(),x(" ",b(8,16,a.lastDate,a.firstDate),""),s(3),g("ngIf",!a.tariffId),s(),g("ngIf",!a.tariffId),s(6),c(a.tariffId?a.tariffStats.buyed_users_count:a.stats.buyed_subs_users_count),s(8),x("",b(26,19,a.tariffId?a.tariffStats.cr:a.stats.cr,"separator.2"),"%"),s(3),c(f(29,22,"stats_page__metric_cr")),s(7),x("",a.tariffId?a.tariffStats.subscriber_lifetime_days:a.stats.subscription_lifetime_days," \u0434\u043D\u0435\u0439"),s(2),c(f(38,24,"stats_page__metric_subscription_lifetime_days")),s(7),I(a.tariffId?a.tariffStats.income_stats:a.stats.income_stats),s(9),I(a.tariffId?a.tariffStats.projected_income_stats:a.stats.projected_income_stats),s(3),c(f(57,26,"stats_page__metric_cr")),s(4),c(f(61,28,"stats_page__subs_stats_section")),s(4),c(a.fromToDate),s(3),g("ngIf",!a.tariffId)}}function Et(t,e){t&1&&p(0," \u20BD ")}function Ot(t,e){t&1&&p(0," $ ")}function Bt(t,e){t&1&&p(0," \u20AC ")}function Dt(t,e){if(t&1&&h(0,Et,1,0)(1,Ot,1,0)(2,Bt,1,0),t&2){let a=e.currency,n=_();T(0,a===n.currencyType.RUB?0:a===n.currencyType.USD?1:2)}}var R=(()=>{let e=class e{constructor(){this.backButton=d(y),this.activatedRoute=d(W),this.statisticService=d(ct),this.lastDate=new Date().getTime(),this.currencyType=it,this.active=[],this.count_gived_by_admin=[],this.count_trial_subs_users_count=[],this.not_prolong_users_count=[]}ngOnInit(){this.backButton.getButton("/menu"),this.loadDate(),this.activatedRoute.params.subscribe(n=>{this.tariffId=n.id,this.tariffId?(this.backButton.getButton("/statistic/tariffs"),this.loadTariffStats()):this.loadStats()})}loadStats(){this.statisticService.main(this.params).subscribe(n=>{this.stats=n,setTimeout(()=>this.loadChart(),10)})}loadTariffStats(){this.statisticService.tariff(this.tariffId,this.params).subscribe(n=>{this.tariffStats=n,setTimeout(()=>this.loadChart(),10)})}loadDate(){let n=localStorage.getItem("statistic_"+tt),i=localStorage.getItem("statistic_"+et);n&&(this.lastDate=Number(n)),i&&(this.firstDate=Number(i))}loadStatistic(){this.tariffId&&this.statisticService.loadStatistic(this.params).subscribe(n=>this.loadStatisticData(n))}loadStatisticData(n){this.tariffId?n.forEach(i=>{this.active.push({x:i.date,y:i.active}),this.count_gived_by_admin.push({x:i.date,y:i.count_gived_by_admin}),this.count_trial_subs_users_count.push({x:i.date,y:i.count_trial_subs_users_count})}):n.forEach(i=>{this.active.push({x:i.date,y:i.active}),this.count_gived_by_admin.push({x:i.date,y:i.count_gived_by_admin}),this.count_trial_subs_users_count.push({x:i.date,y:i.count_trial_subs_users_count}),this.not_prolong_users_count.push({x:i.date,y:i.not_prolong_users_count})})}get params(){return{start:this.firstDate,end:this.lastDate}}loadChart(){this.canvas=this.price.nativeElement,this.ctx=this.canvas.getContext("2d");let n=[{label:"\u0410\u043A\u0442\u0438\u0432\u043D\u044B\u0445 \u043F\u043E\u0434\u043F\u0438\u0441\u043E\u043A",backgroundColor:"rgba(255, 99, 132, 0.0)",borderColor:"#4CC063",fill:!0,data:this.active},{label:"\u0412\u044B\u0434\u0430\u043D\u043E \u0430\u0434\u043C\u0438\u043D\u043E\u043C",backgroundColor:"rgba(255, 99, 132, 0.0)",borderColor:"#3178DE",fill:!0,data:this.count_gived_by_admin},{label:"\u041F\u043E\u0434\u043F\u0438\u0441\u0447\u0438\u043A\u0438 \u0441 \u0442\u0440\u0438\u0430\u043B \u043F\u0435\u0440\u0438\u043E\u0434\u043E\u043C",backgroundColor:"rgba(255, 99, 132, 0.0)",borderColor:"#F7931A",fill:!0,data:this.count_trial_subs_users_count}];!this.tariffId&&n.push({label:"\u041D\u0435 \u043F\u0440\u043E\u0434\u043B\u0438\u0432\u0448\u0438\u0445 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443",backgroundColor:"rgba(255, 99, 132, 0.0)",borderColor:"#B84041",fill:!0,data:this.not_prolong_users_count}),new lt.Chart(this.ctx,{type:"line",data:{datasets:n},options:{plugins:{legend:!0},responsive:!0,scales:{xAxes:[{type:"linear",position:"bottom",ticks:{userCallback:i=>rt(new Date(L(i)).getMonth())+" "+new Date(L(i)).getDate()}}],yAxes:[{type:"linear",ticks:{userCallback:function(i){return i.toString()}}}]}}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=S({type:e,selectors:[["ng-component"]],viewQuery:function(i,v){if(i&1&&G(xt,5),i&2){let V;H(V=z())&&(v.price=V.first)}},decls:3,vars:1,consts:[["amountType",""],["price",""],["class","main","style","margin-bottom: 35px;",4,"ngIf"],[1,"main",2,"margin-bottom","35px"],[1,"title-text"],["href","javascript:void(0)","routerLink","/statistic/calendar"],[1,"white-containers"],["class","item",4,"ngIf"],[1,"item"],[1,"about"],["width","16","height","16","viewBox","0 0 16 16","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M8.92308 12C8.92308 12.1826 8.86894 12.361 8.76751 12.5128C8.66608 12.6646 8.52192 12.7829 8.35325 12.8528C8.18458 12.9227 7.99898 12.941 7.81992 12.9053C7.64086 12.8697 7.47638 12.7818 7.34729 12.6527C7.21819 12.5236 7.13028 12.3591 7.09466 12.1801C7.05904 12.001 7.07732 11.8154 7.14719 11.6468C7.21706 11.4781 7.33537 11.3339 7.48717 11.2325C7.63897 11.1311 7.81743 11.0769 8 11.0769C8.24482 11.0769 8.4796 11.1742 8.65271 11.3473C8.82583 11.5204 8.92308 11.7552 8.92308 12ZM8 3.69231C6.30308 3.69231 4.92308 4.93461 4.92308 6.46154V6.76923C4.92308 6.93244 4.98791 7.08896 5.10332 7.20437C5.21873 7.31978 5.37525 7.38461 5.53846 7.38461C5.70167 7.38461 5.8582 7.31978 5.97361 7.20437C6.08901 7.08896 6.15385 6.93244 6.15385 6.76923V6.46154C6.15385 5.61538 6.98231 4.92308 8 4.92308C9.01769 4.92308 9.84616 5.61538 9.84616 6.46154C9.84616 7.30769 9.01769 8 8 8C7.83679 8 7.68027 8.06483 7.56486 8.18024C7.44945 8.29565 7.38462 8.45217 7.38462 8.61538V9.23077C7.38462 9.39398 7.44945 9.5505 7.56486 9.66591C7.68027 9.78132 7.83679 9.84615 8 9.84615C8.16321 9.84615 8.31974 9.78132 8.43514 9.66591C8.55055 9.5505 8.61539 9.39398 8.61539 9.23077V9.17538C10.0185 8.91769 11.0769 7.79846 11.0769 6.46154C11.0769 4.93461 9.69692 3.69231 8 3.69231ZM16 8C16 9.58225 15.5308 11.129 14.6518 12.4446C13.7727 13.7602 12.5233 14.7855 11.0615 15.391C9.59966 15.9965 7.99113 16.155 6.43928 15.8463C4.88743 15.5376 3.46197 14.7757 2.34315 13.6569C1.22433 12.538 0.462403 11.1126 0.153721 9.56072C-0.15496 8.00887 0.00346628 6.40034 0.608967 4.93853C1.21447 3.47672 2.23985 2.22729 3.55544 1.34824C4.87103 0.469192 6.41775 0 8 0C10.121 0.00223986 12.1546 0.845814 13.6544 2.34562C15.1542 3.84542 15.9978 5.87895 16 8ZM14.7692 8C14.7692 6.66117 14.3722 5.35241 13.6284 4.23922C12.8846 3.12602 11.8274 2.25839 10.5905 1.74605C9.35356 1.2337 7.99249 1.09965 6.67939 1.36084C5.36629 1.62203 4.16013 2.26674 3.21343 3.21343C2.26674 4.16012 1.62203 5.36629 1.36084 6.67939C1.09965 7.99249 1.2337 9.35356 1.74605 10.5905C2.2584 11.8274 3.12603 12.8846 4.23922 13.6284C5.35241 14.3722 6.66117 14.7692 8 14.7692C9.79469 14.7672 11.5153 14.0534 12.7843 12.7843C14.0534 11.5153 14.7672 9.79468 14.7692 8Z","fill","black","fill-opacity","0.3"],[1,"amount"],[1,"description"],[1,"price"],[1,"month-amount"],[1,"container-white"],[1,"from-to"],["width","340","height","350"],["class","container-white position-relative","style","margin-top: 20px;","routerLink","tariffs/",4,"ngIf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["routerLink","tariffs/",1,"container-white","position-relative",2,"margin-top","20px"],[1,"right"],["width","7","height","12","viewBox","0 0 7 12","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M0.292893 10.2929C-0.0976311 10.6834 -0.0976311 11.3166 0.292893 11.7071C0.683418 12.0976 1.31658 12.0976 1.70711 11.7071L6.70711 6.70711C7.09763 6.31658 7.09763 5.68342 6.70711 5.29289L1.70711 0.292893C1.31658 -0.0976311 0.683418 -0.0976311 0.292893 0.292893C-0.0976311 0.683418 -0.0976311 1.31658 0.292893 1.70711L4.58579 6L0.292893 10.2929Z","fill","#3C3C43","fill-opacity","0.3"]],template:function(i,v){i&1&&h(0,wt,68,30,"div",2)(1,Dt,3,1,"ng-template",null,0,U),i&2&&g("ngIf",v.stats||v.tariffStats)},dependencies:[Q,Y,E,pt,st,O],styles:[".white-containers[_ngcontent-%COMP%]{display:flex;justify-content:center;flex-wrap:wrap;gap:10px;width:calc(var(--width) + 40px)}.white-containers[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{width:calc(50% - 46px);background-color:#fff;border-radius:10px;min-height:70px;padding:14px 16px;position:relative}.white-containers[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .about[_ngcontent-%COMP%]{position:absolute;right:5px;top:5px}.white-containers[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{color:#636366;font-size:14px;line-height:18px}.white-containers[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%], .white-containers[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-size:19px;font-weight:500;line-height:22.67px;font-family:SF Pro Text,sans-serif}.white-containers[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-weight:600}.month-amount[_ngcontent-%COMP%]{width:calc(var(--width) - 8px);background-color:#fff;border-radius:10px;min-height:70px;padding:14px 16px;position:relative;margin:30px 0}.month-amount[_ngcontent-%COMP%]   .about[_ngcontent-%COMP%]{position:absolute;right:10px;top:10px}.month-amount[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{color:#636366;font-size:14px;line-height:18px}.month-amount[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-size:19px;font-weight:600;line-height:22.67px;font-family:SF Pro Text,sans-serif}.title-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:19px;font-weight:600;line-height:22.27px}.title-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#007aff;text-decoration:none}"]});let t=e;return t})();var kt=t=>({drop_date:t});function Ft(t,e){if(t&1&&(m(0,"p",5),l(1,"date")),t&2){let a=_().$implicit;g("params",w(4,kt,b(1,1,a.drop_timestamp,"dd.MM.YYYY")))}}function Lt(t,e){if(t&1&&(o(0,"p"),p(1),l(2,"translatePaid"),r()),t&2){let a=_().$implicit;s(),c(f(2,1,a.display_option))}}function Rt(t,e){if(t&1&&(o(0,"div",3)(1,"div",4)(2,"span"),p(3),r(),h(4,Ft,2,6,"p",5)(5,Lt,3,3),r(),o(6,"span",6),u(),o(7,"svg",7),m(8,"path",8),r()()()),t&2){let a=e.$implicit;N("routerLink","/statistic/tariff/",a.id,""),s(3),c(a.name),s(),T(4,a.is_drop_marked?4:5)}}var dt=(()=>{let e=class e{constructor(){this.backButton=d(y),this.tariffService=d(at)}ngOnInit(){this.backButton.getButton("/statistic"),this.tariffService.tariff().subscribe(n=>{this.tariffs=n})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=S({type:e,selectors:[["ng-component"]],decls:7,vars:3,consts:[[1,"main"],[1,"title-text"],[2,"font-weight","600","font-size","19px","line-height","22.27px"],[1,"container-white","card",2,"margin","5px 0",3,"routerLink"],[1,"info"],["translatePaid","admin_panel_tariffs_page__tariff_marked_drop",2,"color","red",3,"params"],[1,"right"],["width","7","height","12","viewBox","0 0 7 12","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M0.292893 10.2929C-0.0976311 10.6834 -0.0976311 11.3166 0.292893 11.7071C0.683418 12.0976 1.31658 12.0976 1.70711 11.7071L6.70711 6.70711C7.09763 6.31658 7.09763 5.68342 6.70711 5.29289L1.70711 0.292893C1.31658 -0.0976311 0.683418 -0.0976311 0.292893 0.292893C-0.0976311 0.683418 -0.0976311 1.31658 0.292893 1.70711L4.58579 6L0.292893 10.2929Z","fill","#3C3C43","fill-opacity","0.3"]],template:function(i,v){i&1&&(o(0,"div",0)(1,"div",1)(2,"p",2),p(3),l(4,"translatePaid"),r()(),P(5,Rt,9,4,"div",3,M),r()),i&2&&(s(3),c(f(4,1,"stats_page__subs_stats__tariff_stats")),s(2),I(v.tariffs))},dependencies:[E,ot,q,O],styles:[".card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#8e8e93;font-size:14px}"]});let t=e;return t})();var ft=(()=>{let e=class e{constructor(){this.backButton=d(y),this.location=d(Z)}ngOnInit(){this.backButton.getButton()}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=S({type:e,selectors:[["ng-component"]],decls:1,vars:0,consts:[["entityName","statistic"]],template:function(i,v){i&1&&m(0,"calendar",0)},dependencies:[B],encapsulation:2});let t=e;return t})();var ye=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=$({type:e}),e.\u0275inj=A({imports:[J,X.forChild([{path:"",component:R},{path:"tariffs",component:dt},{path:"tariff/:id",component:R},{path:"calendar",component:ft}]),B]});let t=e;return t})();export{ye as StatisticModule};
