import{a as ot,b as I}from"./chunk-GHGPH4CG.js";import{b as W,c as X,d as tt}from"./chunk-WVPN4BPJ.js";import{a as it}from"./chunk-ML2VBJXM.js";import{a as mt}from"./chunk-MAAQSTPP.js";import{d as at}from"./chunk-U36VPC2F.js";import{a as nt,d as F}from"./chunk-Q2HNSVUD.js";import"./chunk-Z66TR4HV.js";import{a as y}from"./chunk-XSXLIR7R.js";import{$a as J,Da as k,F as m,Fa as v,G as _,Ha as S,Ia as H,O as c,Pa as z,Ra as U,T as d,Ta as Z,Ua as Q,V as g,Va as Y,Xa as q,aa as b,ba as E,ca as M,cb as w,da as T,ea as o,eb as K,fa as r,fb as et,ga as u,ha as P,ka as l,ma as j,pa as $,q as A,qa as N,r as R,ra as G,sa as D,t as p,ta as s,ua as h,v as x,va as f,w as V}from"./chunk-JKYKRWW6.js";import{f as lt}from"./chunk-DM275RSA.js";var st=lt(mt());var rt=(()=>{let e=class e{constructor(){this.resourceUrl=et("stats"),this.http=p(q)}main(n){return this.http.get(`${this.resourceUrl}/botStats`,{params:this.convert(n)})}tariff(n,i){return this.http.get(`${this.resourceUrl}/tariffStats/${n}`,{params:this.convert(i)})}loadTariffStatistic(n,i){return this.http.get(`${this.resourceUrl}/tariffStats/${n}/subscriptionStats`,{params:this.convert(i)})}loadStatistic(n){return this.http.get(`${this.resourceUrl}/botStats/subscriptionStats`,{params:this.convert(n)})}convert(n){return Object.keys(n).forEach(i=>{n[i]||delete n[i]}),n}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var _t=["price"],ct=t=>({currency:t});function ht(t,e){if(t&1&&(s(0),v(1,"dateRus")),t&2){let a=l(2);f(" ",S(1,1,a.firstDate,a.lastDate)," - ")}}function Ct(t,e){if(t&1&&(o(0,"div",8)(1,"div",9),m(),o(2,"svg",10),u(3,"path",11),r()(),_(),o(4,"span",12),s(5),r(),o(6,"p",13),s(7,"\u041F\u0435\u0440\u0435\u0445\u043E\u0434\u043E\u0432 \u0432 \u0431\u043E\u0442"),r()()),t&2){let a=l(2);c(5),h(a.stats.users_count)}}function gt(t,e){if(t&1&&(o(0,"div",8)(1,"div",9),m(),o(2,"svg",10),u(3,"path",11),r()(),_(),o(4,"span",12),s(5),r(),o(6,"p",13),s(7,"\u0417\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043B\u0438 \u0431\u043E\u0442"),r()()),t&2){let a=l(2);c(5),h(a.stats.inactive_users)}}function xt(t,e){t&1&&P(0)}function vt(t,e){if(t&1&&(o(0,"p"),s(1),d(2,xt,1,0,"ng-container",20),r()),t&2){let a=e.$implicit;l(2);let n=D(2);c(),f("",a.amount," "),c(),g("ngTemplateOutlet",n)("ngTemplateOutletContext",k(3,ct,a.currency))}}function St(t,e){t&1&&P(0)}function yt(t,e){if(t&1&&(o(0,"p"),s(1),d(2,St,1,0,"ng-container",20),r()),t&2){let a=e.$implicit;l(2);let n=D(2);c(),f("",a.amount," "),c(),g("ngTemplateOutlet",n)("ngTemplateOutletContext",k(3,ct,a.currency))}}function bt(t,e){t&1&&(o(0,"div",21)(1,"p"),s(2,"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043A\u0430 \u043F\u043E \u0442\u0430\u0440\u0438\u0444\u0430\u043C"),r(),o(3,"span",22),m(),o(4,"svg",23),u(5,"path",24),r()()())}function Et(t,e){if(t&1&&(o(0,"div",3)(1,"div",4)(2,"p"),s(3," \u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043A\u0430 \u0437\u0430 "),o(4,"a",5),d(5,ht,2,4),s(6),v(7,"dateRus"),r()()(),o(8,"div",6),d(9,Ct,8,1,"div",7)(10,gt,8,1,"div",7),o(11,"div",8)(12,"div",9),m(),o(13,"svg",10),u(14,"path",11),r()(),_(),o(15,"span",12),s(16),r(),o(17,"p",13),s(18,"\u041A\u0443\u043F\u0438\u0432\u0448\u0438\u0445 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443"),r()(),o(19,"div",8)(20,"div",9),m(),o(21,"svg",10),u(22,"path",11),r()(),_(),o(23,"span",12),s(24),v(25,"mask"),r(),o(26,"p",13),s(27,"\u041A\u043E\u043D\u0432\u0435\u0440\u0441\u0438\u044F \u0432 \u043F\u0440\u043E\u0434\u0430\u0436\u0438"),r()(),o(28,"div",8)(29,"div",9),m(),o(30,"svg",10),u(31,"path",11),r()(),_(),o(32,"span",12),s(33),r(),o(34,"p",13),s(35,"\u0412\u0440\u0435\u043C\u044F \u0436\u0438\u0437\u043D\u0438 \u043F\u043E\u0434\u043F\u0438\u0441\u0447\u0438\u043A\u0430"),r()(),o(36,"div",8)(37,"div",9),m(),o(38,"svg",10),u(39,"path",11),r()(),_(),o(40,"div",14),M(41,vt,3,5,"p",null,E),r(),o(43,"p",13),s(44,"\u0414\u043E\u0445\u043E\u0434 \u043F\u0440\u043E\u0435\u043A\u0442\u0430"),r()()(),o(45,"div",15)(46,"div",9),m(),o(47,"svg",10),u(48,"path",11),r()(),_(),o(49,"div",14),M(50,yt,3,5,"p",null,E),r(),o(52,"p",13),s(53,"\u041A\u043E\u043D\u0432\u0435\u0440\u0441\u0438\u044F \u0432 \u043F\u0440\u043E\u0434\u0430\u0436\u0438"),r()(),o(54,"div",4)(55,"p"),s(56,"\u041F\u043E\u0434\u043F\u0438\u0441\u043A\u0438"),r()(),o(57,"div",16)(58,"span",17),s(59),r(),u(60,"canvas",18,1),r(),d(62,bt,6,0,"div",19),r()),t&2){let a=l();c(5),b(5,a.firstDate?5:-1),c(),f(" ",S(7,9,a.lastDate,a.firstDate),""),c(3),g("ngIf",!a.tariffId),c(),g("ngIf",!a.tariffId),c(6),h(a.tariffId?a.tariffStats.buyed_users_count:a.stats.buyed_subs_users_count),c(8),f("",S(25,12,a.tariffId?a.tariffStats.cr:a.stats.cr,"separator.2"),"%"),c(9),f("",a.tariffId?a.tariffStats.subscriber_lifetime_days:a.stats.subscription_lifetime_days," \u0434\u043D\u0435\u0439"),c(8),T(a.tariffId?a.tariffStats.income_stats:a.stats.income_stats),c(9),T(a.tariffId?a.tariffStats.projected_income_stats:a.stats.projected_income_stats),c(9),h(a.fromToDate),c(3),g("ngIf",!a.tariffId)}}function Mt(t,e){t&1&&s(0," \u20BD ")}function Tt(t,e){t&1&&s(0," $ ")}function wt(t,e){t&1&&s(0," \u20AC ")}function It(t,e){if(t&1&&d(0,Mt,1,0)(1,Tt,1,0)(2,wt,1,0),t&2){let a=e.currency,n=l();b(0,a===n.currencyType.RUB?0:a===n.currencyType.USD?1:2)}}var B=(()=>{let e=class e{constructor(){this.backButton=p(y),this.activatedRoute=p(J),this.statisticService=p(rt),this.lastDate=new Date().getTime(),this.currencyType=tt,this.active=[],this.count_gived_by_admin=[],this.count_trial_subs_users_count=[],this.not_prolong_users_count=[]}ngOnInit(){this.backButton.getButton("/menu"),this.loadDate(),this.activatedRoute.params.subscribe(n=>{this.tariffId=n.id,this.tariffId?(this.backButton.getButton("/statistic/tariffs"),this.loadTariffStats()):this.loadStats()})}loadStats(){this.statisticService.main(this.params).subscribe(n=>{this.stats=n,setTimeout(()=>this.loadChart(),10)})}loadTariffStats(){this.statisticService.tariff(this.tariffId,this.params).subscribe(n=>{this.tariffStats=n,setTimeout(()=>this.loadChart(),10)})}loadDate(){let n=localStorage.getItem("statistic_"+W),i=localStorage.getItem("statistic_"+X);n&&(this.lastDate=Number(n)),i&&(this.firstDate=Number(i))}loadStatistic(){this.tariffId&&this.statisticService.loadStatistic(this.params).subscribe(n=>this.loadStatisticData(n))}loadStatisticData(n){this.tariffId?n.forEach(i=>{this.active.push({x:i.date,y:i.active}),this.count_gived_by_admin.push({x:i.date,y:i.count_gived_by_admin}),this.count_trial_subs_users_count.push({x:i.date,y:i.count_trial_subs_users_count})}):n.forEach(i=>{this.active.push({x:i.date,y:i.active}),this.count_gived_by_admin.push({x:i.date,y:i.count_gived_by_admin}),this.count_trial_subs_users_count.push({x:i.date,y:i.count_trial_subs_users_count}),this.not_prolong_users_count.push({x:i.date,y:i.not_prolong_users_count})})}get params(){return{start:this.firstDate,end:this.lastDate}}loadChart(){this.canvas=this.price.nativeElement,this.ctx=this.canvas.getContext("2d");let n=[{label:"\u0410\u043A\u0442\u0438\u0432\u043D\u044B\u0445 \u043F\u043E\u0434\u043F\u0438\u0441\u043E\u043A",backgroundColor:"rgba(255, 99, 132, 0.0)",borderColor:"#4CC063",fill:!0,data:this.active},{label:"\u0412\u044B\u0434\u0430\u043D\u043E \u0430\u0434\u043C\u0438\u043D\u043E\u043C",backgroundColor:"rgba(255, 99, 132, 0.0)",borderColor:"#3178DE",fill:!0,data:this.count_gived_by_admin},{label:"\u041F\u043E\u0434\u043F\u0438\u0441\u0447\u0438\u043A\u0438 \u0441 \u0442\u0440\u0438\u0430\u043B \u043F\u0435\u0440\u0438\u043E\u0434\u043E\u043C",backgroundColor:"rgba(255, 99, 132, 0.0)",borderColor:"#F7931A",fill:!0,data:this.count_trial_subs_users_count}];!this.tariffId&&n.push({label:"\u041D\u0435 \u043F\u0440\u043E\u0434\u043B\u0438\u0432\u0448\u0438\u0445 \u043F\u043E\u0434\u043F\u0438\u0441\u043A\u0443",backgroundColor:"rgba(255, 99, 132, 0.0)",borderColor:"#B84041",fill:!0,data:this.not_prolong_users_count}),new st.Chart(this.ctx,{type:"line",data:{datasets:n},options:{plugins:{legend:!0},responsive:!0,scales:{xAxes:[{type:"linear",position:"bottom",ticks:{userCallback:i=>nt(new Date(F(i)).getMonth())+" "+new Date(F(i)).getDate()}}],yAxes:[{type:"linear",ticks:{userCallback:function(i){return i.toString()}}}]}}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=x({type:e,selectors:[["ng-component"]],viewQuery:function(i,C){if(i&1&&$(_t,5),i&2){let L;N(L=G())&&(C.price=L.first)}},decls:3,vars:1,consts:[["amountType",""],["price",""],["class","main","style","margin-bottom: 35px;",4,"ngIf"],[1,"main",2,"margin-bottom","35px"],[1,"title-text"],["href","javascript:void(0)","routerLink","/statistic/calendar"],[1,"white-containers"],["class","item",4,"ngIf"],[1,"item"],[1,"about"],["width","16","height","16","viewBox","0 0 16 16","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M8.92308 12C8.92308 12.1826 8.86894 12.361 8.76751 12.5128C8.66608 12.6646 8.52192 12.7829 8.35325 12.8528C8.18458 12.9227 7.99898 12.941 7.81992 12.9053C7.64086 12.8697 7.47638 12.7818 7.34729 12.6527C7.21819 12.5236 7.13028 12.3591 7.09466 12.1801C7.05904 12.001 7.07732 11.8154 7.14719 11.6468C7.21706 11.4781 7.33537 11.3339 7.48717 11.2325C7.63897 11.1311 7.81743 11.0769 8 11.0769C8.24482 11.0769 8.4796 11.1742 8.65271 11.3473C8.82583 11.5204 8.92308 11.7552 8.92308 12ZM8 3.69231C6.30308 3.69231 4.92308 4.93461 4.92308 6.46154V6.76923C4.92308 6.93244 4.98791 7.08896 5.10332 7.20437C5.21873 7.31978 5.37525 7.38461 5.53846 7.38461C5.70167 7.38461 5.8582 7.31978 5.97361 7.20437C6.08901 7.08896 6.15385 6.93244 6.15385 6.76923V6.46154C6.15385 5.61538 6.98231 4.92308 8 4.92308C9.01769 4.92308 9.84616 5.61538 9.84616 6.46154C9.84616 7.30769 9.01769 8 8 8C7.83679 8 7.68027 8.06483 7.56486 8.18024C7.44945 8.29565 7.38462 8.45217 7.38462 8.61538V9.23077C7.38462 9.39398 7.44945 9.5505 7.56486 9.66591C7.68027 9.78132 7.83679 9.84615 8 9.84615C8.16321 9.84615 8.31974 9.78132 8.43514 9.66591C8.55055 9.5505 8.61539 9.39398 8.61539 9.23077V9.17538C10.0185 8.91769 11.0769 7.79846 11.0769 6.46154C11.0769 4.93461 9.69692 3.69231 8 3.69231ZM16 8C16 9.58225 15.5308 11.129 14.6518 12.4446C13.7727 13.7602 12.5233 14.7855 11.0615 15.391C9.59966 15.9965 7.99113 16.155 6.43928 15.8463C4.88743 15.5376 3.46197 14.7757 2.34315 13.6569C1.22433 12.538 0.462403 11.1126 0.153721 9.56072C-0.15496 8.00887 0.00346628 6.40034 0.608967 4.93853C1.21447 3.47672 2.23985 2.22729 3.55544 1.34824C4.87103 0.469192 6.41775 0 8 0C10.121 0.00223986 12.1546 0.845814 13.6544 2.34562C15.1542 3.84542 15.9978 5.87895 16 8ZM14.7692 8C14.7692 6.66117 14.3722 5.35241 13.6284 4.23922C12.8846 3.12602 11.8274 2.25839 10.5905 1.74605C9.35356 1.2337 7.99249 1.09965 6.67939 1.36084C5.36629 1.62203 4.16013 2.26674 3.21343 3.21343C2.26674 4.16012 1.62203 5.36629 1.36084 6.67939C1.09965 7.99249 1.2337 9.35356 1.74605 10.5905C2.2584 11.8274 3.12603 12.8846 4.23922 13.6284C5.35241 14.3722 6.66117 14.7692 8 14.7692C9.79469 14.7672 11.5153 14.0534 12.7843 12.7843C14.0534 11.5153 14.7672 9.79468 14.7692 8Z","fill","black","fill-opacity","0.3"],[1,"amount"],[1,"description"],[1,"price"],[1,"month-amount"],[1,"container-white"],[1,"from-to"],["width","340","height","350"],["class","container-white position-relative","style","margin-top: 20px;","routerLink","tariffs/",4,"ngIf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["routerLink","tariffs/",1,"container-white","position-relative",2,"margin-top","20px"],[1,"right"],["width","7","height","12","viewBox","0 0 7 12","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M0.292893 10.2929C-0.0976311 10.6834 -0.0976311 11.3166 0.292893 11.7071C0.683418 12.0976 1.31658 12.0976 1.70711 11.7071L6.70711 6.70711C7.09763 6.31658 7.09763 5.68342 6.70711 5.29289L1.70711 0.292893C1.31658 -0.0976311 0.683418 -0.0976311 0.292893 0.292893C-0.0976311 0.683418 -0.0976311 1.31658 0.292893 1.70711L4.58579 6L0.292893 10.2929Z","fill","#3C3C43","fill-opacity","0.3"]],template:function(i,C){i&1&&d(0,Et,63,15,"div",2)(1,It,3,1,"ng-template",null,0,H),i&2&&g("ngIf",C.stats||C.tariffStats)},dependencies:[U,Z,w,ot,at],styles:[".white-containers[_ngcontent-%COMP%]{display:flex;justify-content:center;flex-wrap:wrap;gap:10px;width:calc(var(--width) + 40px)}.white-containers[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{width:calc(50% - 46px);background-color:#fff;border-radius:10px;min-height:70px;padding:14px 16px;position:relative}.white-containers[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .about[_ngcontent-%COMP%]{position:absolute;right:5px;top:5px}.white-containers[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{color:#636366;font-size:14px;line-height:18px}.white-containers[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%], .white-containers[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-size:19px;font-weight:500;line-height:22.67px;font-family:SF Pro Text,sans-serif}.white-containers[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-weight:600}.month-amount[_ngcontent-%COMP%]{width:calc(var(--width) - 8px);background-color:#fff;border-radius:10px;min-height:70px;padding:14px 16px;position:relative;margin:30px 0}.month-amount[_ngcontent-%COMP%]   .about[_ngcontent-%COMP%]{position:absolute;right:10px;top:10px}.month-amount[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{color:#636366;font-size:14px;line-height:18px}.month-amount[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-size:19px;font-weight:600;line-height:22.67px;font-family:SF Pro Text,sans-serif}.title-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:19px;font-weight:600;line-height:22.27px}.title-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#007aff;text-decoration:none}"]});let t=e;return t})();function Ot(t,e){if(t&1&&(o(0,"p",5),s(1),v(2,"date"),r()),t&2){let a=l().$implicit;c(),f("\u0423\u0434\u0430\u043B\u0435\u043D\u0438\u0435 ",S(2,1,a.drop_timestamp,"dd.MM.YYYY"),"")}}function Pt(t,e){if(t&1&&(o(0,"p"),s(1),r()),t&2){let a=l().$implicit,n=l();c(),h(n.types[a.display_option])}}function Dt(t,e){if(t&1&&(o(0,"div",3)(1,"div",4)(2,"span"),s(3),r(),d(4,Ot,3,4,"p",5)(5,Pt,2,1),r(),o(6,"span",6),m(),o(7,"svg",7),u(8,"path",8),r()()()),t&2){let a=e.$implicit;j("routerLink","/statistic/tariff/",a.id,""),c(3),h(a.name),c(),b(4,a.is_drop_marked?4:5)}}var ut=(()=>{let e=class e{constructor(){this.backButton=p(y),this.tariffService=p(it),this.types={tariff_display_option_disabled:"tariff_display_option_disabled",tariff_display_options_only_for_url_access:"\u041F\u043E \u0441\u0441\u044B\u043B\u043A\u0435",tariff_display_options_only_for_selected_users:"\u041D\u0435\u043A\u043E\u0442\u043E\u0440\u044B\u043C",tariff_display_option_not_prolong:"\u041D\u0438\u043A\u043E\u043C\u0443",tariff_display_option_for_subscribers:"\u041F\u043E\u0434\u043F\u0438\u0441\u0447\u0438\u043A\u0430\u043C",tariff_display_option_for_all:"\u0412\u0441\u0435\u043C"}}ngOnInit(){this.backButton.getButton("/statistic"),this.tariffService.tariff().subscribe(n=>{this.tariffs=n})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=x({type:e,selectors:[["ng-component"]],decls:6,vars:0,consts:[[1,"main"],[1,"title-text"],[2,"font-weight","600","font-size","19px","line-height","22.27px"],[1,"container-white","card",2,"margin","5px 0",3,"routerLink"],[1,"info"],[2,"color","red"],[1,"right"],["width","7","height","12","viewBox","0 0 7 12","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M0.292893 10.2929C-0.0976311 10.6834 -0.0976311 11.3166 0.292893 11.7071C0.683418 12.0976 1.31658 12.0976 1.70711 11.7071L6.70711 6.70711C7.09763 6.31658 7.09763 5.68342 6.70711 5.29289L1.70711 0.292893C1.31658 -0.0976311 0.683418 -0.0976311 0.292893 0.292893C-0.0976311 0.683418 -0.0976311 1.31658 0.292893 1.70711L4.58579 6L0.292893 10.2929Z","fill","#3C3C43","fill-opacity","0.3"]],template:function(i,C){i&1&&(o(0,"div",0)(1,"div",1)(2,"p",2),s(3,"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043A\u0430 \u043F\u043E \u0442\u0430\u0440\u0438\u0444\u0430\u043C"),r()(),M(4,Dt,9,4,"div",3,E),r()),i&2&&(c(4),T(C.tariffs))},dependencies:[w,Q],styles:[".card[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#8e8e93;font-size:14px}"]});let t=e;return t})();var pt=(()=>{let e=class e{constructor(){this.backButton=p(y),this.location=p(z)}ngOnInit(){this.backButton.getButton()}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=x({type:e,selectors:[["ng-component"]],decls:1,vars:0,consts:[["entityName","statistic"]],template:function(i,C){i&1&&u(0,"calendar",0)},dependencies:[I],encapsulation:2});let t=e;return t})();var de=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=V({type:e}),e.\u0275inj=R({imports:[Y,K.forChild([{path:"",component:B},{path:"tariffs",component:ut},{path:"tariff/:id",component:B},{path:"calendar",component:pt}]),I]});let t=e;return t})();export{de as StatisticModule};
